<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY ENGLISH SCHOOL SURYAKHEDA - LIVE SCORE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #020617; color: white; margin: 0; overflow-x: hidden; }
        .header-font { font-family: 'Oswald', sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); position: relative; }
        .input-field { background: #0f172a !important; border: 2px solid #1e293b; color: white !important; width: 100%; padding: 0.8rem; border-radius: 0.8rem; margin-top: 0.25rem; appearance: auto; }
        .btn-portal { background: linear-gradient(135deg, #1e293b, #0f172a); border: 1px solid rgba(255,255,255,0.1); cursor: pointer; width: 100%; padding: 1rem; border-radius: 1rem; font-weight: 900; text-transform: uppercase; transition: 0.3s; }
        .rank-badge { position: absolute; top: -15px; left: 20px; background: #facc15; color: black; padding: 5px 15px; border-radius: 8px; font-weight: 900; font-size: 11px; z-index: 20; animation: pulse 2s infinite; display: none; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .cap-tag { font-size: 9px; font-weight: 700; color: #cbd5e1; display: block; background: rgba(255,255,255,0.05); padding: 3px 8px; border-radius: 4px; margin-bottom: 2px; border-left: 3px solid; text-transform: uppercase; }
        .red-l { border-color: #ef4444; } .yellow-l { border-color: #facc15; } .green-l { border-color: #22c55e; } .blue-l { border-color: #3b82f6; }
        .news-ticker { position: fixed; bottom: 0; left: 0; width: 100%; background: #0f172a; border-top: 2px solid #6366f1; padding: 12px 0; z-index: 1000; overflow: hidden; }
        .ticker-wrap { display: inline-block; white-space: nowrap; animation: ticker-scroll 30s linear infinite; }
        @keyframes ticker-scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
    </style>
</head>
<body onload="initializePoints()">

    <header class="p-8 text-center bg-slate-900 border-b-2 border-indigo-500/50">
        <h1 class="header-font text-3xl md:text-6xl font-extrabold text-white uppercase mb-2">My English School Suryakheda</h1>
        <p class="text-indigo-300 font-bold text-[10px] md:text-xs uppercase italic mb-6">Suryakheda, Tehsil: Sitamau, Dist: Mandsaur (M.P.)</p>
        <div class="flex flex-col md:flex-row justify-center gap-4">
            <div class="bg-slate-800 px-6 py-2 rounded-full border border-yellow-500/40 flex items-center gap-2">
                <span class="text-xs text-yellow-500 font-black uppercase italic">Director:</span> <span class="text-sm font-bold">Aiti Jain</span> <span class="text-xs font-bold text-slate-400 border-l border-slate-600 pl-2">94245 61121</span>
            </div>
            <div class="bg-slate-800 px-6 py-2 rounded-full border border-indigo-500/40 flex items-center gap-2">
                <span class="text-xs text-indigo-400 font-black uppercase italic">Principal:</span> <span class="text-sm font-bold">Rekha Jain</span> <span class="text-xs font-bold text-slate-400 border-l border-slate-600 pl-2">99778 35914</span>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-2 mt-12 max-w-[1400px] pb-32">
        
        <div class="mb-16">
            <h2 class="header-font text-2xl md:text-4xl text-white uppercase tracking-[0.2em] italic text-center mb-10">üèÜ Grand Total (Combined Points)</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="glass p-4 rounded-[30px] border-l-[8px] border-red-600 relative">
                    <div class="rank-badge" id="rank-Red">‚≠ê LEADER</div>
                    <div id="comb-red" class="text-6xl font-black mb-4 text-white">0</div>
                    <div class="text-[12px] font-black text-red-500 uppercase mb-4">RED GROUP TOTAL</div>
                    <div class="space-y-1">
                        <span class="cap-tag red-l">BOY-CAPT: NAYAN PATIDAR</span><span class="cap-tag red-l">BOY-V.CAPT: AASHISH SHARMA</span><span class="cap-tag red-l">GIRL-CAPT: GAYATREE GURJAR</span><span class="cap-tag red-l">GIRL-V.CAPT: KOMAL CHOUHAN</span>
                    </div>
                </div>
                <div class="glass p-4 rounded-[30px] border-l-[8px] border-yellow-400 relative">
                    <div class="rank-badge" id="rank-Yellow">‚≠ê LEADER</div>
                    <div id="comb-yellow" class="text-6xl font-black mb-4 text-white">0</div>
                    <div class="text-[12px] font-black text-yellow-400 uppercase mb-4">YELLOW GROUP TOTAL</div>
                    <div class="space-y-1">
                        <span class="cap-tag yellow-l">BOY-CAPT: SHUBHAM PATIDAR</span><span class="cap-tag yellow-l">BOY-V.CAPT: YUVRAJ BHATI</span><span class="cap-tag yellow-l">GIRL-CAPT: SHRADDHA PATIDAR</span><span class="cap-tag yellow-l">GIRL-V.CAPT: DOLI KACHHAWA</span>
                    </div>
                </div>
                <div class="glass p-4 rounded-[30px] border-l-[8px] border-green-500 relative">
                    <div class="rank-badge" id="rank-Green">‚≠ê LEADER</div>
                    <div id="comb-green" class="text-6xl font-black mb-4 text-white">0</div>
                    <div class="text-[12px] font-black text-green-500 uppercase mb-4">GREEN GROUP TOTAL</div>
                    <div class="space-y-1">
                        <span class="cap-tag green-l">BOY-CAPT: SHUBHAM SHARMA</span><span class="cap-tag green-l">BOY-V.CAPT: PRADEEP PRAJAPAT</span><span class="cap-tag green-l">GIRL-CAPT: SALONI HILORIYA</span><span class="cap-tag green-l">GIRL-V.CAPT: VARSHA PATIDAR</span>
                    </div>
                </div>
                <div class="glass p-4 rounded-[30px] border-l-[8px] border-blue-500 relative">
                    <div class="rank-badge" id="rank-Blue">‚≠ê LEADER</div>
                    <div id="comb-blue" class="text-6xl font-black mb-4 text-white">0</div>
                    <div class="text-[12px] font-black text-blue-500 uppercase mb-4">BLUE GROUP TOTAL</div>
                    <div class="space-y-1">
                        <span class="cap-tag blue-l">BOY-CAPT: KRISHNA PATIDAR</span><span class="cap-tag blue-l">BOY-V.CAPT: NAITIK KUMAR</span><span class="cap-tag blue-l">GIRL-CAPT: AASHIYANA BEE KHAN</span><span class="cap-tag blue-l">GIRL-V.CAPT: MONIKA PRAJAPAT</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-16">
            <h2 class="header-font text-xl text-indigo-400 uppercase italic tracking-[0.2em] mb-8 text-center">üèÅ Overall Group Standings</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 max-w-6xl mx-auto">
                <div class="glass p-10 rounded-[40px] text-center border-b-[10px] border-red-600">
                    <span class="text-xs font-black block text-red-500 mb-2 uppercase">RED GROUP</span><span id="over-red" class="text-6xl font-black">0</span>
                </div>
                <div class="glass p-10 rounded-[40px] text-center border-b-[10px] border-yellow-500">
                    <span class="text-xs font-black block text-yellow-500 mb-2 uppercase">YELLOW GROUP</span><span id="over-yellow" class="text-6xl font-black">0</span>
                </div>
                <div class="glass p-10 rounded-[40px] text-center border-b-[10px] border-green-500">
                    <span class="text-xs font-black block text-green-500 mb-2 uppercase">GREEN GROUP</span><span id="over-green" class="text-6xl font-black">0</span>
                </div>
                <div class="glass p-10 rounded-[40px] text-center border-b-[10px] border-blue-500">
                    <span class="text-xs font-black block text-blue-500 mb-2 uppercase">BLUE GROUP</span><span id="over-blue" class="text-6xl font-black">0</span>
                </div>
            </div>
        </div>

        <div class="mb-16 glass p-8 rounded-[40px] border-t border-white/5">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                <h2 class="header-font text-xl text-white uppercase italic tracking-widest">üìä Class-Wise Standings</h2>
                <div class="flex items-center gap-3">
                    <span class="text-[10px] font-bold text-slate-400 uppercase">Select Class:</span>
                    <select id="classFilter" class="bg-slate-900 border border-slate-700 px-4 py-1 rounded-lg text-sm text-yellow-500 font-bold" onchange="updateClassUI()">
                        <option>Nursery</option><option>LKG</option><option>UKG</option>
                        <script>for(let i=1;i<=12;i++) document.write(`<option>Class ${i}</option>`);</script>
                    </select>
                </div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-slate-900/80 p-6 rounded-3xl border border-red-500/20 text-center"><div class="text-[10px] text-red-500 font-black mb-1 uppercase">RED</div><div id="class-red" class="text-4xl font-black">0</div></div>
                <div class="bg-slate-900/80 p-6 rounded-3xl border border-yellow-500/20 text-center"><div class="text-[10px] text-yellow-500 font-black mb-1 uppercase">YELLOW</div><div id="class-yellow" class="text-4xl font-black">0</div></div>
                <div class="bg-slate-900/80 p-6 rounded-3xl border border-green-500/20 text-center"><div class="text-[10px] text-green-500 font-black mb-1 uppercase">GREEN</div><div id="class-green" class="text-4xl font-black">0</div></div>
                <div class="bg-slate-900/80 p-6 rounded-3xl border border-blue-500/20 text-center"><div class="text-[10px] text-blue-500 font-black mb-1 uppercase">BLUE</div><div id="class-blue" class="text-4xl font-black">0</div></div>
            </div>
        </div>

        <div class="max-w-4xl mx-auto space-y-12">
            <div class="glass p-8 rounded-[40px] border-t-8 border-yellow-500">
                <h2 class="header-font text-3xl mb-8 text-yellow-500 text-center uppercase italic font-black">üèÜ Group Entry Portal</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="g-game" placeholder="Event Name" class="input-field md:col-span-2">
                    <select id="g-catSelect" class="input-field font-bold"><option>Senior</option><option>Junior</option><option>Mini</option></select>
                    <select id="g-groupSelect" class="input-field font-bold"><option value="Red">üî¥ Red Group</option><option value="Yellow">üü° Yellow Group</option><option value="Green">üü¢ Green Group</option><option value="Blue">üîµ Blue Group</option></select>
                    <select id="g-pointsSelect" class="input-field font-bold md:col-span-2"><option value="3">ü•á 1st Position (3 Pts)</option><option value="2">ü•à 2nd Position (2 Pts)</option><option value="1">ü•â 3rd Position (1 Pt)</option></select>
                    <button onclick="sendToExcelGroup()" class="btn-portal text-yellow-500 md:col-span-2 mt-4">Save Group Entry üöÄ</button>
                </div>
            </div>
            <div class="glass p-8 rounded-[40px] border-t-8 border-blue-500">
                <h2 class="header-font text-3xl mb-8 text-blue-400 text-center uppercase italic font-black">üéì Class Entry Portal</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="c-game" placeholder="Event Name" class="input-field">
                    <select id="c-classSelect" class="input-field font-bold"><option>Nursery</option><option>LKG</option><option>UKG</option><script>for(let i=1;i<=12;i++) document.write(`<option>Class ${i}</option>`);</script></select>
                    <input type="text" id="c-studentName" placeholder="Student Name" class="input-field md:col-span-2">
                    <select id="c-groupSelect" class="input-field font-bold"><option value="Red">üî¥ Red Group</option><option value="Yellow">üü° Yellow Group</option><option value="Green">üü¢ Green Group</option><option value="Blue">üîµ Blue Group</option></select>
                    <select id="c-pointsSelect" class="input-field font-bold"><option value="3">ü•á 1st Position (3 Pts)</option><option value="2">ü•à 2nd Position (2 Pts)</option><option value="1">ü•â 3rd Position (1 Pt)</option></select>
                    <button onclick="sendToExcelClass()" class="btn-portal text-blue-400 md:col-span-2 mt-4">Save Class Entry üöÄ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="news-ticker"><div class="ticker-wrap" id="tickerContent">Please wait, loading live scores...</div></div>

    <footer class="text-center py-20 pb-40 border-t border-slate-800">
        <p class="text-indigo-400 font-bold text-[10px] uppercase tracking-widest mb-1">Website Designed & Developed By</p>
        <h3 class="header-font text-3xl font-black text-yellow-500 uppercase tracking-widest">HARIOM SHARMA</h3>
        <p class="text-slate-500 text-[10px] font-bold mt-2 uppercase tracking-tighter">¬© 2025 All Rights Reserved | HARIOM SHARMA SITAMAU</p>
    </footer>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwGIXiqUcCeAHnnkRvcB1695Yhb4LI9uwVBwBe0mVHPcWn0FhbNIIfDiciZno6b3pEM/exec"; 
        let rawData = { totals: {}, classData: {} };

        async function initializePoints() { fetchData(); setInterval(fetchData, 8000); }

        async function fetchData() {
            try {
                const res = await fetch(SCRIPT_URL);
                const data = await res.json();
                rawData = data; // ‡§™‡•Ç‡§∞‡§æ ‡§°‡•á‡§ü‡§æ ‡§∏‡•ç‡§ü‡•ã‡§∞ ‡§ï‡§∞‡•á‡§Ç
                updateUI();
            } catch (e) { console.log("Refresh Error"); }
        }

        // ‡§∏‡•ç‡§™‡•á‡§≤‡§ø‡§Ç‡§ó ‡§ï‡•ã ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§§‡§∞‡•Ä‡§ï‡•á ‡§∏‡•á ‡§™‡•ù‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
        function getSafePoints(obj, groupName) {
            if (!obj) return 0;
            let total = 0;
            for (let key in obj) {
                if (key.toLowerCase().trim() === groupName.toLowerCase()) {
                    total += parseInt(obj[key]) || 0;
                }
            }
            return total;
        }

        function updateUI() {
            let groups = ['Red', 'Yellow', 'Green', 'Blue'];
            let finalScores = { Red: 0, Yellow: 0, Green: 0, Blue: 0 };

            // 1. GroupEntry ‡§µ‡§æ‡§≤‡•á ‡§™‡•â‡§á‡§Ç‡§ü‡•ç‡§∏ ‡§ú‡•ã‡•ú‡•á‡§Ç
            groups.forEach(g => {
                finalScores[g] += getSafePoints(rawData.totals, g);
            });

            // 2. ClassEntry ‡§µ‡§æ‡§≤‡•á ‡§∏‡§æ‡§∞‡•á ‡§™‡•â‡§á‡§Ç‡§ü‡•ç‡§∏ ‡§ú‡•ã‡•ú‡•á‡§Ç
            for (let cls in rawData.classData) {
                groups.forEach(g => {
                    finalScores[g] += getSafePoints(rawData.classData[cls], g);
                });
            }

            // 3. UI ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            groups.forEach(g => {
                let score = finalScores[g];
                document.getElementById('comb-' + g.toLowerCase()).innerText = score;
                document.getElementById('over-' + g.toLowerCase()).innerText = score;
            });

            updateClassUI();

            // Leader Badge
            let sorted = Object.entries(finalScores).sort((a, b) => b[1] - a[1]);
            let topGroup = sorted[0][0];
            groups.forEach(g => {
                document.getElementById('rank-' + g).style.display = (g === topGroup && finalScores[g] > 0) ? 'block' : 'none';
            });

            document.getElementById('tickerContent').innerHTML = `<span class="px-10 font-black">üî• LEADER: ${topGroup.toUpperCase()} GROUP</span><span class="px-10 font-bold">RED: ${finalScores.Red} | YELLOW: ${finalScores.Yellow} | GREEN: ${finalScores.Green} | BLUE: ${finalScores.Blue}</span>`;
        }

        function updateClassUI() {
            let cls = document.getElementById('classFilter').value;
            let classData = rawData.classData[cls] || {};
            ['Red', 'Yellow', 'Green', 'Blue'].forEach(g => {
                document.getElementById('class-' + g.toLowerCase()).innerText = getSafePoints(classData, g);
            });
        }

        async function sendToExcelGroup() {
            const pass = prompt("Password:"); if (pass !== "SITAMAU") return;
            const data = {
                sheetName: "GroupEntry",
                event: document.getElementById('g-game').value,
                category: document.getElementById('g-catSelect').value,
                group: document.getElementById('g-groupSelect').value,
                position: document.getElementById('g-pointsSelect').options[document.getElementById('g-pointsSelect').selectedIndex].text,
                points: parseInt(document.getElementById('g-pointsSelect').value)
            };
            await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
            confetti({ particleCount: 150 });
            setTimeout(fetchData, 1500);
        }

        async function sendToExcelClass() {
            const name = document.getElementById('c-studentName').value;
            if(!name) return alert("Student Name Required!");
            const pass = prompt("Password:"); if (pass !== "SITAMAU") return;
            const data = {
                sheetName: "ClassEntry",
                event: document.getElementById('c-game').value,
                class: document.getElementById('c-classSelect').value,
                student: name,
                group: document.getElementById('c-groupSelect').value,
                position: document.getElementById('c-pointsSelect').options[document.getElementById('c-pointsSelect').selectedIndex].text,
                points: parseInt(document.getElementById('c-pointsSelect').value)
            };
            await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
            confetti({ particleCount: 100 });
            document.getElementById('c-studentName').value = "";
            setTimeout(fetchData, 1500);
        }
    </script>
</body>
</html>
